<!DOCTYPE html>
<html>
  <head>
    <title>Auth full stack app</title>
    <script src = "https://cdnjs.cloudflare.com/ajax/libs/axios/1.7.7/axios.min.js"></script>
    <script>
      async function getUserInfo(){
        document.getElementById("signup-div").innerHTML = '';
        document.getElementById("signin-div").innerHTML = '';
        const token = localStorage.getItem("token");

        if(token){
          const response = await axios.get("http://localhost:3000/me",{
            headers: {
              token: token
            }
          })
          document.getElementById("user-info").innerHTML = `Username: ${response.data.username} <br> Password: ${response.data.password}`;
        }
      }
      async function signup(){
        const username = document.getElementById("username-id").value;
        const password = document.getElementById("password-id").value;
        await axios.post("http://localhost:3000/signup", {
          username,
          password
        })
        alert("user signed in");
      }

      async function signin(){
        const username = document.getElementById("signinUsername").value;
        const password = document.getElementById("signinPassword").value;

        const response = await axios.post("http://localhost:3000/signin",{
          username,
          password
        });

        localStorage.setItem("token", response.data.token);
        alert("signed in successfully");
        
        getUserInfo();
      }
      
      async function userLogout(){
        document.querySelector("body").innerHTML = ''
        const newHeading = document.createElement("h2");
        newHeading.innerHTML = "User Logged Out";
        document.querySelector("body").appendChild(newHeading);
        localStorage.removeItem("token");
      }

    </script>
  </head>
  <body>

    <div id = "signup-div">
      Signup
      <input id = "username-id" type = "text" name = "username" placeholder = "Username">
      <input id = "password-id" type = "text" name = "password" placeholder = "Password">
      <button onclick = "signup()">Submit</button>
    </div>

    <div id = "signin-div">
      Signin
      <input id = "signinUsername" type = "text" name = "username" placeholder = "Username">
      <input id = "signinPassword" type = "text" name = "password" placeholder = "Password">
      <button onclick = "signin()">Submit</button>
    </div>
    
    <div>
      <h2>User Information</h2>
      <div id = "user-info"></div>
    </div>

    <button onclick = "userLogout()">
      Logout
    </button>
  </body>
</html>